<!doctype html>
<html>

<head>
    <title>"RT" ovládání robota</title>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <style>
        /*#rychlost_range {
            transform: rotate(90deg);
        }*/
    </style>
</head>

<body>
    <h1>Zaklad ovladani robota :)</h1>
    <div id="log"></div>
    <br>
    <label for="vol">Rychlost: 0-100</label>
    <div class="rychlost_slider">
        <input class="slider" type="range" id="rychlost_range" name="vol" min="0" max="100">
    </div>
    <div class="btn-group" role="group" aria-label="Ovladani">
        <button id="but1" class="tlac" ontouchstart="startSending(1, 100)" ontouchend="stopSending()"
            onmousedown="startSending(1, 100)" onmouseup="stopSending()">vpřed</button>
        <button id="but2" class="tlac" ontouchstart="startSending(2, 100)" ontouchend="stopSending()"
            onmousedown="startSending(2, 100)" onmouseup="stopSending()">vlevo</button>
        <button id="but3" class="tlac" ontouchstart="startSending(3, 100)" ontouchend="stopSending()"
            onmousedown="startSending(3, 100)" onmouseup="stopSending()">vpravo</button>
        <button id="but4" class="tlac" ontouchstart="startSending(4, 100)" ontouchend="stopSending()"
            onmousedown="startSending(4, 100)" onmouseup="stopSending()">vzad</button>
    </div>
        <button id="back-button" class="back-button" onclick="window.location.href='/'">Zpět</button>
        <script>
            let rychlost_slider = document.getElementById("rychlost_range");

            let socket = new WebSocket("ws://" + location.host + "/prijem");
            let commandSent = false;

            socket.addEventListener("open", (ev) => {
                console.log("WebSocket connection opened");
            });

            socket.addEventListener("close", (ev) => {
                console.log("WebSocket connection closed");
            });

            socket.addEventListener("error", (ev) => {
                console.error("WebSocket error:", ev);
            });

            socket.addEventListener("message", (ev) => {
                console.log("WebSocket message received:", ev.data);
            });

            function startSending(i1, i2) {
                if (socket.readyState === WebSocket.OPEN && !commandSent) {
                    odeslani_prikazu('start', i1, rychlost_slider.value);
                    commandSent = true;
                } else {
                    console.error("WebSocket is not open or command already sent");
                }
            }

            function stopSending() {
                commandSent = false;
                if (socket.readyState === WebSocket.OPEN) {
                    odeslani_prikazu('stop', 0, 0);
                } else {
                    console.error("WebSocket is not open, stop");
                }
            }

            function odeslani_prikazu(command, i1, i2) {
                if (socket.readyState === WebSocket.OPEN) {
                    socket.send(command + " " + i1 + " " + i2);
                    console.log("Sent command:", command, i1, i2);
                } else {
                    console.error("WebSocket is not open, odeslani");
                }
            }
        </script>
</body>

</html>